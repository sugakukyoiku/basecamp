{{- /* リンク先のパスを取得 */ -}}
{{- $path := .Get "link" | default (.Get "url") -}}
{{- $page := .Site.GetPage $path -}}

{{- if $page -}}
    <article class="mycard-container" style="
        display: flex;
        flex-direction: column;
        background: var(--card-background, #fff);
        border: 1px solid var(--card-border, #eee);
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        overflow: hidden;
        margin: 30px 0;
        text-decoration: none;
    ">
        
        {{- /* ▼▼▼ 画像エリア（上部） ▼▼▼ */ -}}
        {{- /* 画像の名前を取得 */ -}}
        {{- $imageName := .Get "image" | default $page.Params.image -}}
        {{- $imageSrc := "" -}}

        {{- if $imageName -}}
            {{- /* 1. その記事の中に画像リソースとして含まれているか探す（Aパターン対応） */ -}}
            {{- $resource := $page.Resources.GetMatch $imageName -}}
            
            {{- if $resource -}}
                {{- /* あった！その画像の正しいURLを使う */ -}}
                {{- $imageSrc = $resource.RelPermalink -}}
            {{- else -}}
                {{- /* リソースとして見つからない場合 */ -}}
                {{- if or (hasPrefix $imageName "http") (hasPrefix $imageName "/") -}}
                    {{- /* http~ や /~ で始まるならそのまま使う（Bパターン対応） */ -}}
                    {{- $imageSrc = $imageName -}}
                {{- else -}}
                    {{- /* ただのファイル名なら、記事のパスと合体させる */ -}}
                    {{- $imageSrc = printf "%s%s" $page.RelPermalink $imageName -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
        
        {{- if $imageSrc -}}
            <div class="mycard-image" style='
                width: 100%;
                height: 30px;   /* ★ここを30pxに戻しました！ */
                flex-shrink: 0;
            '>
                <a href="{{ $page.RelPermalink }}" style="display: block; width: 100%; height: 100%;">
                    <img src="{{ $imageSrc }}" loading="lazy" style="
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        object-position: center;
                        margin: 0;
                    ">
                </a>
            </div>
        {{- end -}}

        {{- /* ▼▼▼ テキストエリア（下部） ▼▼▼ */ -}}
        <div class="mycard-details" style="padding: 20px; display: flex; flex-direction: column;">
            
            {{- /* タイトル */ -}}
            <h3 style="
                margin: 0 0 10px 0; 
                font-size: 1.6rem;
                font-weight: bold;
                line-height: 1.4; 
                color: #333 !important;
                border-left: none !important;
                padding-left: 0 !important;
            ">
                <a href="{{ $page.RelPermalink }}" style="text-decoration: none; color: inherit;">
                    {{ .Get "title" | default $page.Title }}
                </a>
            </h3>

            {{- /* 説明文 */ -}}
            <div style="
                font-size: 1.2rem;
                opacity: 0.8; 
                color: #555 !important; 
                line-height: 1.6;
            ">
                {{ .Get "description" | default $page.Description | default $page.Summary | plainify | truncate 80 }}
            </div>
        </div>

    </article>
{{- else -}}
    <div style="color: red; padding: 10px; border: 1px dashed red;">
        リンクが見つかりません: {{ $path }}
    </div>
{{- end -}}
